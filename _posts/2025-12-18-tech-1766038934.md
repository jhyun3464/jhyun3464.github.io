---
layout: post
title: "Tech Trend - I got hacked - My Hetzner server started mining Monero"
date: 2025-12-18
categories: [tech]
tags: [tech, update]
header:
  overlay_image: /assets/images/posts/tech_IgothackedMyHetzners_1766038928.jpg
  teaser: /assets/images/posts/tech_IgothackedMyHetzners_1766038928.jpg
---

![Header Image](/assets/images/posts/tech_IgothackedMyHetzners_1766038928.jpg)

## Analysis of a Next.js RCE and Monero Cryptojacking Incident: A Case Study in Effective Container Isolation

### Executive Summary
An engineer's Hetzner server experienced a Monero cryptojacking incident stemming from an exploited Next.js RCE vulnerability (CVE-2025-66478) within a third-party Umami analytics container. Despite the malware's high CPU consumption and network scanning activities, robust Docker container configurations – specifically running as a non-root user with no privileged access or host mounts – successfully contained the compromise, preventing any breach of the host system. This case powerfully demonstrates the critical role of secure containerization practices and the risks associated with unexamined software dependencies.

### Key Technical Details
*   **Incident Trigger**: The attack was detected via an abuse report from Hetzner indicating network scanning originating from the user's server.
*   **Initial Diagnostics**: High load average (15x normal, typically 0.5-1.0) and `ps aux` output revealed `javae` and `xmrig` processes consuming significant CPU (up to 819%). `xmrig` is a known Monero cryptocurrency miner.
*   **Targeted Vulnerability**: The root cause was identified as CVE-2025-66478, a Remote Code Execution (RCE) vulnerability in Next.js. This flaw exploited unsafe deserialization in the React Server Components "Flight" protocol, allowing arbitrary code execution via a specially crafted HTTP request to an App Router endpoint.
*   **Compromised Service**: The vulnerability was exploited in an Umami analytics container, which is built with Next.js, a dependency the user was unaware of. The compromise began around December 7th, aligning with the Umami container's deployment nine days prior.
*   **Malware Characteristics**: The cryptominer, `xmrig-6.24.0`, was found deployed within the container at `/app/node_modules/next/dist/server/lib/xmrig-6.24.0/`. It targeted `auto.c3pool.org:443` for Monero mining.
*   **Effective Containment**: All malicious processes ran as user `1001` (`nextjs`) *inside* the Docker container. Critical factors preventing host compromise included:
    *   The container ran as a non-root user (`nextjs`, UID 1001).
    *   The container was not configured with `privileged` access.
    *   The container had zero host volume mounts, isolating its filesystem.
*   **Verification of Isolation**: A host-level `ls -la` command for the suspicious `/tmp/.XIN-unix/javae` path returned "No such file or directory," confirming that `ps aux` output reflected container processes within their isolated mount namespace, not on the host filesystem.
*   **Resolution**: The incident was resolved by simply stopping and removing the compromised Umami Docker container. Host-level security was further hardened by enabling UFW to deny all incoming traffic by default, only allowing SSH, HTTP, and HTTPS.

### Industry Impact / Analysis
This incident provides a compelling illustration of several critical cybersecurity lessons relevant to the broader tech industry:

1.  **Dependency Awareness is Paramount**: The core lesson is that developers must thoroughly understand the full technology stack of *all* their applications, including indirect and third-party dependencies. The assumption "I don't use Next.js" proved insufficient when an analytics tool leveraged it, exposing the infrastructure to a critical vulnerability. This underscores the need for robust software supply chain security and dependency scanning tools.
2.  **Container Isolation Works (When Configured Properly)**: This case serves as a strong validation of Docker's security model. By adhering to best practices—running containers as non-root, avoiding privileged access, and minimizing host mounts—the impact of a critical RCE was confined solely to the compromised container. This prevented lateral movement, host persistence, and widespread data loss, saving the operator from a costly full server rebuild.
3.  **Risk of Default Configurations**: The article highlights the danger of PaaS solutions or auto-generated container images (e.g., Nixpacks) that may default to `USER root`. Such configurations eliminate the critical isolation boundary that saved the author's infrastructure, turning a contained incident into a catastrophic host compromise. Custom Dockerfiles that prioritize least privilege are essential.
4.  **Proactive Vulnerability Management**: Even for "simple" third-party tools, vigilance regarding disclosed vulnerabilities and timely patching is crucial. The operator's delay in addressing the Next.js RCE, despite its public disclosure, created the window for exploitation.
5.  **External Monitoring as a First Line of Defense**: The initial alert from Hetzner's abuse report demonstrates the value of external network monitoring and service provider vigilance in detecting compromise, even when internal monitoring might be lacking or overwhelmed.

[Original Source](https://blog.jakesaunders.dev/my-server-started-mining-monero-this-morning/)

---
[< Back to Home](/)
